<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CNN Subscription Simulator</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f9f9f9; padding: 24px; }
    
    /* Header styles */
    .main-header {
      text-align: center;
      margin-bottom: 30px;
      padding: 30px 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .welcome-title {
      font-size: 28px;
      font-weight: bold;
      color: #333;
      margin: 20px 0 10px 0;
    }
    
    .welcome-subtitle {
      font-size: 16px;
      color: #666;
      margin-bottom: 20px;
    }
    
    .header-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }
    
    .header-button {
      padding: 10px 24px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .set-report-button {
      background: #007bff;
      color: white;
    }
    
    .set-report-button:hover {
      background: #0056b3;
    }
    
    .run-simulation-button {
      background: #28a745;
      color: white;
    }
    
    .run-simulation-button:hover {
      background: #218838;
    }
    
    .report-type-display {
      margin-top: 15px;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 4px;
      font-size: 14px;
      display: none;
    }
    
    .report-type-display strong {
      color: #333;
    }
    
    .controls-section { 
      text-align: center; 
      margin-bottom: 20px; 
      background: white; 
      padding: 20px; 
      border-radius: 8px; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
      position: relative;
    }
    
    .clear-button {
      position: absolute;
      right: 20px;
      top: 20px;
      padding: 8px 16px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .clear-button:hover {
      background: #c82333;
    }
    
    .clear-button:active {
      transform: translateY(1px);
    }
    
    .controls-section h2 { margin-top: 0; font-size: 18px; color: #333; }
    .product-toggles { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 15px; }
    .toggle-btn { padding: 8px 16px; background: #eee; border: 2px solid #ddd; border-radius: 4px; cursor: pointer; font-weight: bold; transition: all 0.2s; }
    .toggle-btn.active { background: #1a73e8; color: white; border-color: #1a73e8; }
    .toggle-btn:hover { transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .select-controls { margin-bottom: 10px; }
    .select-controls button { padding: 6px 12px; background: white; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; margin: 0 5px; font-size: 13px; }
    .select-controls button:hover { background: #f5f5f5; }
    .card-container { display: flex; gap: 20px; overflow-x: auto; padding-bottom: 20px; }
    .card { flex: 0 0 380px; background: white; padding: 20px; border-radius: 8px; border: 1px solid #ccc; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 24px; box-sizing: border-box; position: relative; transition: opacity 0.3s; }
    .card.inactive { opacity: 0.5; }
    .card.inactive::after { content: 'EXCLUDED FROM SIMULATION'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-20deg); background: rgba(255,0,0,0.1); color: #cc0000; padding: 10px 20px; border: 2px solid #cc0000; border-radius: 8px; font-weight: bold; font-size: 14px; pointer-events: none; }
    .header { background: #cc0000; color: white; padding: 16px; font-weight: bold; font-size: 18px; text-align: center; border-radius: 6px; margin: -20px -20px 20px -20px; text-transform: uppercase; }
    select { width: 100%; padding: 12px; font-size: 15px; margin-bottom: 16px; box-sizing: border-box; }
    label { color: #000; font-weight: bold; margin-top: 10px; margin-bottom: 4px; display: block; font-size: 14px; }
    .add-btn { width: 100%; padding: 8px; background: white; border: 2px solid #000; border-radius: 4px; cursor: pointer; margin-bottom: 10px; font-size: 14px; }
    .add-btn:hover { background: #f5f5f5; border-color: #cc0000; }
    .feature-list { margin-bottom: 15px; border: 1px solid #eee; border-radius: 4px; padding: 5px; }
    .feature-item { display: flex; justify-content: space-between; padding: 6px 8px; font-size: 14px; border-bottom: 1px solid #f0f0f0; }
    .feature-item:last-child { border-bottom: none; }
    .remove { color: #cc0000; cursor: pointer; font-weight: bold; font-size: 16px; }
    .btn-group { display: flex; gap: 10px; margin: 12px 0; }
    .btn-group button { flex: 1; padding: 10px; cursor: pointer; background: #eee; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
    .btn-group button.active { background: #1a73e8; color: white; }
    .discount-options { background: #f8f9fa; padding: 12px; margin: 10px 0; border-radius: 4px; }
    .discount-options h4 { font-size: 14px; margin: 0 0 8px 0; }
    .discount-option { font-size: 13px; padding: 4px 0; }
    input[type="range"] { width: 100%; margin: 10px 0; }
    .price-labels { display: flex; justify-content: space-between; font-size: 13px; font-weight: bold; margin-top: -5px; }
    .pricing-display { margin-top: 12px; font-size: 14px; }
    .pricing-table { width: 100%; font-size: 14px; border-collapse: collapse; margin-top: 10px; }
    .pricing-table td, .pricing-table th { padding: 6px; text-align: center; border: 1px solid #ddd; }
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .modal { background: white; padding: 20px; border-radius: 8px; max-width: 400px; max-height: 80vh; overflow-y: auto; }
    .modal h3 { margin-top: 0; }
    .select-all { margin: 10px 0; text-align: right; }
    .select-all button { background: #1a73e8; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; }
    .select-all button:hover { background: #1557b0; }
    .modal-options { margin: 10px 0; }
    .modal-option { padding: 8px; margin: 4px 0; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; display: flex; align-items: center; }
    .modal-option:hover { background: #e8e8e8; }
    .modal-option.selected { background: #e3f2fd; border-color: #1a73e8; }
    .modal-option input { margin-right: 10px; }
    .modal-buttons { display: flex; gap: 10px; margin-top: 15px; }
    .modal-buttons button { flex: 1; padding: 8px 16px; border-radius: 4px; cursor: pointer; border: none; }
    .modal-add { background: #1a73e8; color: white; }
    .modal-add:hover { background: #1557b0; }
    .modal-cancel { background: #eee; color: #333; border: 1px solid #ccc; }
    .modal-cancel:hover { background: #ddd; }
    
    /* Report styles */
    .report-modal { 
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%; 
      background: rgba(0,0,0,0.5); 
      display: none; 
      align-items: center; 
      justify-content: center; 
      z-index: 2000; 
    }
    .report-modal-content { 
      background: white; 
      padding: 30px; 
      border-radius: 8px; 
      max-width: 500px; 
      width: 90%; 
    }
    .report-modal h2 { 
      margin-top: 0; 
      color: #333; 
    }
    .report-option { 
      margin: 20px 0; 
    }
    .report-option label { 
      display: block; 
      margin-bottom: 10px; 
      font-weight: bold; 
    }
    .report-option input[type="radio"] { 
      margin-right: 10px; 
    }
    .report-buttons { 
      display: flex; 
      gap: 10px; 
      margin-top: 30px; 
    }
    .report-buttons button { 
      flex: 1; 
      padding: 10px; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 16px; 
    }
    .generate-report { 
      background: #28a745; 
      color: white; 
    }
    .generate-report:hover { 
      background: #218838; 
    }
    .cancel-report { 
      background: #6c757d; 
      color: white; 
    }
    .cancel-report:hover { 
      background: #5a6268; 
    }
    
    /* Report Table Styles */
    .report-container { 
      display: none; 
      margin: 40px 20px; 
      background: white; 
      padding: 20px; 
      border-radius: 8px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
      overflow-x: auto; 
    }
    .report-header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 20px; 
    }
    .report-header h2 { 
      margin: 0; 
    }
    .report-table { 
      width: 100%; 
      border-collapse: collapse; 
      font-size: 14px; 
    }
    .report-table th, .report-table td { 
      padding: 8px; 
      text-align: left; 
      border: 1px solid #ddd; 
    }
    .report-table th { 
      background: #f8f9fa; 
      font-weight: bold; 
      position: sticky; 
      top: 0; 
      z-index: 10; 
    }
    .report-table th:first-child { 
      min-width: 100px;
      max-width: 200px;
    }
    .report-table tbody tr:nth-child(even) { 
      background: #f8f9fa; 
    }
    .group-header { 
      font-weight: bold; 
      background: #e9ecef !important; 
    }
    .sub-row { 
      padding-left: 20px; 
    }
    .sub-row-parent {
      padding-left: 20px;
      font-weight: 600;
    }
    .sub-row-indent { 
      padding-left: 40px;
      font-style: italic;
    }
    .download-btn { 
      padding: 8px 16px; 
      background: #007bff; 
      color: white; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer; 
    }
    .download-btn:hover { 
      background: #0056b3; 
    }
  </style>
  <script>
    // Store card data
    const cardData = {};
    const activeProducts = new Set([1, 2, 3, 4]);
    let currentModalData = { cardNum: '', type: '' };
    let currentReportType = null;
    let currentOutputType = null;

    // Initialize card data
    for (let i = 1; i <= 8; i++) {
      cardData[i] = {
        product: '',
        readerFeatures: [],
        streamingFeatures: [],
        verticals: [],
        monthlyRate: 10,
        pricingType: '',
        discount: ''
      };
    }

    // Pricing ranges by product
    const pricingRanges = {
      'CNN Reader': { min: 5, max: 25, default: 10 },
      'CNN Streaming': { min: 10, max: 40, default: 20 },
      'CNN All-Access': { min: 15, max: 50, default: 30 },
      'CNN Standalone Vertical': { min: 3, max: 15, default: 8 }
    };

    // Get pricing range for product
    function getPricingRangeForProduct(product, verticalCount = 0) {
      const baseRange = pricingRanges[product] || { min: 5, max: 50, default: 10 };
      
      if (product === 'CNN Standalone Vertical') {
        return baseRange;
      }
      
      return {
        min: baseRange.min + (verticalCount * 2),
        max: baseRange.max + (verticalCount * 2),
        default: baseRange.default + (verticalCount * 2)
      };
    }

    // Clear all selections
    function clearAllSelections() {
      if (!confirm('Are you sure you want to clear all product configurations? This cannot be undone.')) {
        return;
      }
      
      // Reset all card data
      for (let i = 1; i <= 8; i++) {
        cardData[i] = {
          product: '',
          readerFeatures: [],
          streamingFeatures: [],
          verticals: [],
          monthlyRate: 10,
          pricingType: '',
          discount: ''
        };
        
        // Reset the product select dropdown
        const card = document.querySelector(`[data-card="${i}"]`);
        const select = card.querySelector('.product-select');
        select.value = '';
        
        // Clear the content area
        const content = card.querySelector('.content');
        content.innerHTML = '';
        
        // Reset the header
        const header = card.querySelector('.header');
        header.textContent = `PRODUCT ${i}`;
      }
      
      // Hide any open report
      document.getElementById('reportContainer').style.display = 'none';
      
      // Optional: Show confirmation
      alert('All selections have been cleared!');
    }

    // Toggle product active/inactive
    function toggleProduct(num) {
      const card = document.querySelector(`[data-card="${num}"]`);
      const toggleBtn = document.querySelectorAll('.toggle-btn')[num - 1];
      
      if (activeProducts.has(num)) {
        activeProducts.delete(num);
        card.classList.remove('active');
        card.classList.add('inactive');
        toggleBtn.classList.remove('active');
      } else {
        activeProducts.add(num);
        card.classList.add('active');
        card.classList.remove('inactive');
        toggleBtn.classList.add('active');
      }
    }

    // Select all products
    function selectAllProducts() {
      for (let i = 1; i <= 8; i++) {
        if (!activeProducts.has(i)) {
          toggleProduct(i);
        }
      }
    }

    // Deselect all products
    function deselectAllProducts() {
      for (let i = 1; i <= 8; i++) {
        if (activeProducts.has(i)) {
          toggleProduct(i);
        }
      }
    }

    // Select specific products
    function selectProducts(nums) {
      for (let i = 1; i <= 8; i++) {
        if (activeProducts.has(i)) {
          activeProducts.delete(i);
          document.querySelector(`[data-card="${i}"]`).classList.remove('active');
          document.querySelector(`[data-card="${i}"]`).classList.add('inactive');
          document.querySelectorAll('.toggle-btn')[i - 1].classList.remove('active');
        }
      }
      nums.forEach(i => {
        activeProducts.add(i);
        document.querySelector(`[data-card="${i}"]`).classList.add('active');
        document.querySelector(`[data-card="${i}"]`).classList.remove('inactive');
        document.querySelectorAll('.toggle-btn')[i - 1].classList.add('active');
      });
    }

    function updateCard(card, product) {
      const cardNum = card.dataset.card;
      const content = card.querySelector('.content');
      const header = card.querySelector('.header');
      
      cardData[cardNum].product = product;
      
      // Update header with product name or default
      header.textContent = product || `PRODUCT ${cardNum}`;
      
      content.innerHTML = '';
      
      if (!product) return;
      
      // Get pricing for this product
      const pricing = getPricingRangeForProduct(product, cardData[cardNum].verticals.length);
      
      if (product === 'CNN Standalone Vertical') {
        content.innerHTML = `
          <label>Select Vertical</label>
          <select class="vertical-select">
            <option value="">Select Vertical</option>
            <option>CNN Longevity</option>
            <option>CNN Meditation & Mindfulness</option>
            <option>CNN Fitness</option>
            <option>CNN Entertainment Tracker</option>
            <option>CNN Expert Buying Guide</option>
            <option>CNN Personal Finance</option>
            <option>CNN Travel</option>
            <option>CNN Home</option>
            <option>CNN Beauty</option>
            <option>CNN Weather & Natural Phenomena</option>
          </select>
        `;
      } else {
        let html = '';
        
        if (product === 'CNN Reader' || product === 'CNN All-Access') {
          html += `
            <label>Reader Features (<span class="reader-count">0</span> selected)</label>
            <button class="add-btn" onclick="addFeatures('${cardNum}', 'reader')">+ Add</button>
            <div class="feature-list reader-list"></div>
          `;
        }
        
        if (product === 'CNN Streaming' || product === 'CNN All-Access') {
          html += `
            <label>Streaming Features (<span class="streaming-count">0</span> selected)</label>
            <button class="add-btn" onclick="addFeatures('${cardNum}', 'streaming')">+ Add</button>
            <div class="feature-list streaming-list"></div>
          `;
        }
        
        html += `
          <label>Verticals (<span class="vertical-count">0</span> selected)</label>
          <button class="add-btn" onclick="addFeatures('${cardNum}', 'vertical')">+ Add</button>
          <div class="feature-list vertical-list"></div>
        `;
        
        content.innerHTML = html;
        
        // Restore features display
        updateFeatureDisplay(cardNum, 'reader');
        updateFeatureDisplay(cardNum, 'streaming');
        updateFeatureDisplay(cardNum, 'vertical');
      }
      
      // Add pricing section
      content.innerHTML += `
        <label>Configure Pricing</label>
        <div class="btn-group">
          <button onclick="setPricing('${cardNum}', 'monthly', this)">Monthly Only</button>
          <button onclick="setPricing('${cardNum}', 'annual', this)">Annual Only</button>
          <button onclick="setPricing('${cardNum}', 'both', this)">Both</button>
        </div>
        <div class="discount-section"></div>
        <input type="range" min="${pricing.min}" max="${pricing.max}" value="${pricing.default}" class="price-slider" oninput="updatePrice('${cardNum}', this.value)">
        <div class="price-labels">
          <span>$${pricing.min.toFixed(2)}/mo</span>
          <span>$${pricing.max.toFixed(2)}/mo</span>
        </div>
        <div class="pricing-display">
          <div><strong>Monthly:</strong> $${pricing.default.toFixed(2)}</div>
          <div style="color: #666;">Inferred Annual: $${(pricing.default * 12).toFixed(2)}</div>
        </div>
      `;
      
      cardData[cardNum].monthlyRate = pricing.default;
    }

    function addFeatures(cardNum, type) {
      const features = {
        reader: ['CNN Reality Check', 'Podcast Club', 'News from Local Providers', 'CNN You', 'CNN Technology Insider', 'Bonus Subscription', 'News from Global Providers', 'CNN Live Events and Expert', 'Ask CNN', 'AI Anchor', 'CNN Business & Markets Insider', 'CNN Archive'],
        streaming: ['Multiview', 'Personalized Daily Video Briefings', 'Real-Time Fact Checking', 'CNN You Streaming', 'Live Q&A with CNN Experts', 'Live Global Feeds', 'Customized Local News', 'Original Short-Form CNN Series', 'Live Text Commentary from CNN Experts', 'Interactive Video Companions', 'Real-Time News Ticker', 'Exclusive, Subscriber-Only Events'],
        vertical: ['CNN Longevity', 'CNN Meditation & Mindfulness', 'CNN Fitness', 'CNN Entertainment Tracker', 'CNN Expert Buying Guide', 'CNN Personal Finance', 'CNN Travel', 'CNN Home', 'CNN Beauty', 'CNN Weather & Natural Phenomena']
      };
      
      const selected = cardData[cardNum][type + (type === 'vertical' ? 's' : 'Features')];
      const available = features[type].filter(f => !selected.includes(f));
      
      if (type === 'vertical' && selected.length >= 3) {
        alert('Maximum 3 verticals allowed');
        return;
      }
      
      if (available.length === 0) {
        alert('No more features available to add');
        return;
      }
      
      currentModalData = { cardNum, type };
      
      const modal = document.getElementById('featureModal');
      const modalTitle = document.getElementById('modalTitle');
      const modalOptions = document.getElementById('modalOptions');
      
      modalTitle.textContent = `Select ${type === 'reader' ? 'Reader' : type === 'streaming' ? 'Streaming' : 'Vertical'} Features`;
      
      let selectAllHtml = '';
      if (type !== 'vertical') {
        selectAllHtml = `<div class="select-all"><button onclick="selectAllFeatures()">Select All</button></div>`;
      }
      
      modalOptions.innerHTML = selectAllHtml + available.map((f, i) => 
        `<div class="modal-option" onclick="toggleFeature(this)">
          <input type="checkbox" value="${f}" />
          <span>${i + 1}. ${f}</span>
        </div>`
      ).join('');
      
      modal.style.display = 'flex';
    }
    
    function toggleFeature(optionDiv) {
      const { type, cardNum } = currentModalData;
      
      if (type === 'vertical') {
        const checkboxes = document.querySelectorAll('#modalOptions input[type="checkbox"]:checked');
        const currentSelected = cardData[cardNum].verticals.length;
        
        if (checkboxes.length + currentSelected >= 3 && !optionDiv.querySelector('input').checked) {
          alert('Maximum 3 verticals allowed');
          return;
        }
      }
      
      const checkbox = optionDiv.querySelector('input[type="checkbox"]');
      checkbox.checked = !checkbox.checked;
      optionDiv.classList.toggle('selected', checkbox.checked);
    }
    
    function selectAllFeatures() {
      const checkboxes = document.querySelectorAll('#modalOptions input[type="checkbox"]');
      const options = document.querySelectorAll('#modalOptions .modal-option');
      
      checkboxes.forEach((checkbox, index) => {
        checkbox.checked = true;
        options[index].classList.add('selected');
      });
    }
    
    function addSelectedFeatures() {
      const { cardNum, type } = currentModalData;
      const selected = cardData[cardNum][type + (type === 'vertical' ? 's' : 'Features')];
      const checkboxes = document.querySelectorAll('#modalOptions input[type="checkbox"]:checked');
      
      let added = 0;
      checkboxes.forEach(checkbox => {
        if (type === 'vertical' && selected.length >= 3) {
          return;
        }
        selected.push(checkbox.value);
        added++;
      });
      
      if (added > 0) {
        updateFeatureDisplay(cardNum, type);
        
        // Update pricing if verticals changed
        if (type === 'vertical') {
          const card = document.querySelector(`[data-card="${cardNum}"]`);
          const product = cardData[cardNum].product;
          const pricing = getPricingRangeForProduct(product, cardData[cardNum].verticals.length);
          
          const slider = card.querySelector('.price-slider');
          const priceLabels = card.querySelector('.price-labels');
          
          if (slider && priceLabels) {
            slider.min = pricing.min;
            slider.max = pricing.max;
            if (cardData[cardNum].monthlyRate < pricing.min || cardData[cardNum].monthlyRate > pricing.max) {
              slider.value = pricing.default;
              cardData[cardNum].monthlyRate = pricing.default;
            }
            
            priceLabels.innerHTML = `
              <span>$${pricing.min.toFixed(2)}/mo</span>
              <span>$${pricing.max.toFixed(2)}/mo</span>
            `;
            
            updatePriceDisplay(cardNum);
          }
        }
      }
      
      closeModal();
    }
    
    function closeModal() {
      document.getElementById('featureModal').style.display = 'none';
      currentModalData = { cardNum: '', type: '' };
    }

    function removeFeature(cardNum, type, feature) {
      const selected = cardData[cardNum][type + (type === 'vertical' ? 's' : 'Features')];
      const index = selected.indexOf(feature);
      if (index > -1) {
        selected.splice(index, 1);
        updateFeatureDisplay(cardNum, type);
        
        if (type === 'vertical') {
          const card = document.querySelector(`[data-card="${cardNum}"]`);
          const product = cardData[cardNum].product;
          const pricing = getPricingRangeForProduct(product, cardData[cardNum].verticals.length);
          
          const slider = card.querySelector('.price-slider');
          const priceLabels = card.querySelector('.price-labels');
          
          if (slider && priceLabels) {
            slider.min = pricing.min;
            slider.max = pricing.max;
            if (cardData[cardNum].monthlyRate < pricing.min || cardData[cardNum].monthlyRate > pricing.max) {
              slider.value = pricing.default;
              cardData[cardNum].monthlyRate = pricing.default;
            }
            
            priceLabels.innerHTML = `
              <span>$${pricing.min.toFixed(2)}/mo</span>
              <span>$${pricing.max.toFixed(2)}/mo</span>
            `;
            
            updatePriceDisplay(cardNum);
          }
        }
      }
    }

    function updateFeatureDisplay(cardNum, type) {
      const card = document.querySelector(`[data-card="${cardNum}"]`);
      if (!card) return;
      
      const list = card.querySelector(`.${type}-list`);
      const count = card.querySelector(`.${type}-count`);
      
      if (!list || !count) return;
      
      const selected = cardData[cardNum][type + (type === 'vertical' ? 's' : 'Features')];
      
      list.innerHTML = selected.map(f => 
        `<div class="feature-item">
          <span>${f}</span>
          <span class="remove" onclick="removeFeature('${cardNum}', '${type}', '${f}')">×</span>
        </div>`
      ).join('');
      
      count.textContent = selected.length;
    }

    function setPricing(cardNum, type, btn) {
      const btnGroup = btn.parentElement;
      btnGroup.querySelectorAll('button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      cardData[cardNum].pricingType = type;
      
      const card = document.querySelector(`[data-card="${cardNum}"]`);
      const discountSection = card.querySelector('.discount-section');
      
      if (type === 'both') {
        discountSection.innerHTML = `
          <div class="discount-options">
            <h4>Select Discount</h4>
            <hr>
            <div class="discount-option">
              <label><input type="radio" name="discount${cardNum}" value="free" onchange="setDiscount('${cardNum}', 'free')"> Free Month / 3 Months</label>
            </div>
            <div class="discount-option">
              <label><input type="radio" name="discount${cardNum}" value="30" onchange="setDiscount('${cardNum}', '30')"> 30% off 12-Mo Sub</label>
            </div>
            <div class="discount-option">
              <label><input type="radio" name="discount${cardNum}" value="50" onchange="setDiscount('${cardNum}', '50')"> 50% off 12-Mo Sub</label>
            </div>
          </div>
        `;
      } else {
        discountSection.innerHTML = '';
        cardData[cardNum].discount = '';
      }
    }

    function setDiscount(cardNum, discount) {
      cardData[cardNum].discount = discount;
      updatePriceDisplay(cardNum);
    }

    function updatePrice(cardNum, value) {
      cardData[cardNum].monthlyRate = parseFloat(value);
      updatePriceDisplay(cardNum);
    }

    function updatePriceDisplay(cardNum) {
      const card = document.querySelector(`[data-card="${cardNum}"]`);
      if (!card) return;
      
      const display = card.querySelector('.pricing-display');
      if (!display) return;
      
      const rate = cardData[cardNum].monthlyRate;
      const type = cardData[cardNum].pricingType;
      const discount = cardData[cardNum].discount;
      
      if (type === 'both' && discount) {
        let year1Monthly = rate * 11;
        let year1Annual = rate * 12;
        
        if (discount === 'free') year1Annual = rate * 9;
        else if (discount === '30') year1Annual = rate * 12 * 0.7;
        else if (discount === '50') year1Annual = rate * 12 * 0.5;
        
        display.innerHTML = `
          <table class="pricing-table">
            <tr>
              <th></th>
              <th>$/mo</th>
              <th>Month-to-Month</th>
              <th>12-mo Sub</th>
            </tr>
            <tr>
              <td><strong>Year 1</strong></td>
              <td>$${rate.toFixed(2)}</td>
              <td>$${year1Monthly.toFixed(2)}</td>
              <td>$${year1Annual.toFixed(2)}</td>
            </tr>
            <tr>
              <td><strong>Year 2</strong></td>
              <td>$${rate.toFixed(2)}</td>
              <td>$${(rate * 12).toFixed(2)}</td>
              <td>$${(rate * 12).toFixed(2)}</td>
            </tr>
          </table>
        `;
      } else {
        display.innerHTML = `
          <div><strong>Monthly:</strong> $${rate.toFixed(2)}</div>
          <div style="color: #666;">Inferred Annual: $${(rate * 12).toFixed(2)}</div>
        `;
      }
    }

    // Show report configuration modal
    function showReportModal() {
      document.getElementById('reportModal').style.display = 'flex';
    }

    // Close report modal
    function closeReportModal() {
      document.getElementById('reportModal').style.display = 'none';
    }

    // Set report type
    function setReportType() {
      showReportModal();
    }

    // Generate the report
    function generateReport() {
      const reportType = document.querySelector('input[name="reportType"]:checked').value;
      const outputType = document.querySelector('input[name="outputType"]:checked').value;
      
      // Store the selections
      currentReportType = reportType;
      currentOutputType = outputType;
      
      // Update the display
      const display = document.getElementById('reportTypeDisplay');
      const reportTypeText = reportType === 'tiered' ? 'Tiered Bundles' : 'Independent Products';
      const outputTypeText = outputType === 'percentage' ? 'Take Rates (%)' : 
                           outputType === 'population' ? 'Population Counts (#)' : 'Revenue ($)';
      
      display.innerHTML = `<strong>Report Type:</strong> ${reportTypeText} | <strong>Output:</strong> ${outputTypeText}`;
      display.style.display = 'block';
      
      // Close modal
      closeReportModal();
    }

    // Run simulation with current report settings
    function runSimulation() {
      if (!currentReportType || !currentOutputType) {
        alert('Please set report type first by clicking "Set Report Type"');
        return;
      }
      
      // Check if any products are configured
      const hasProducts = Array.from(activeProducts).some(num => cardData[num].product);
      if (!hasProducts) {
        alert('Please configure at least one product before running simulation');
        return;
      }
      
      // Generate report data
      const reportData = calculateReportData(currentReportType, currentOutputType);
      
      // Display report
      displayReport(reportData, currentReportType, currentOutputType);
      
      // Show report container
      document.getElementById('reportContainer').style.display = 'block';
      
      // Scroll to report
      document.getElementById('reportContainer').scrollIntoView({ behavior: 'smooth' });
    }

    // Calculate report data based on selections
    function calculateReportData(reportType, outputType) {
      // Get active products with configurations
      const activeConfiguredProducts = Array.from(activeProducts)
        .filter(num => cardData[num].product)
        .map(num => ({
          id: num,
          name: `Product ${num}`,
          config: cardData[num]
        }));
      
      // Define demographic segments
      const segments = [
        { group: 'Total TAM', subgroups: [{ name: 'All Respondents', factor: 1.0 }] },
        { 
          group: 'News Access & Subscriptions', 
          subgroups: [
            { name: 'Regularly Access CNN', factor: 0.60, indent: 0 },
            { name: 'Regularly Access CNN & 1+ News Subs', factor: 0.35, indent: 1 },
            { name: 'Regularly Access CNN & 0 News Subs', factor: 0.25, indent: 1 },
            { name: 'Occasionally Access CNN', factor: 0.40, indent: 0 },
            { name: 'Occasionally Access CNN & 1+ News Subs', factor: 0.15, indent: 1 },
            { name: 'Occasionally Access CNN & 0 News Subs', factor: 0.25, indent: 1 }
          ]
        },
        {
          group: 'Gender',
          subgroups: [
            { name: 'Men', factor: 0.48 },
            { name: 'Women', factor: 0.52 }
          ]
        },
        {
          group: 'Political Party',
          subgroups: [
            { name: 'Democrat', factor: 0.33 },
            { name: 'Independent', factor: 0.34 },
            { name: 'Republican', factor: 0.33 }
          ]
        },
        {
          group: 'Age Groups',
          subgroups: [
            { name: '18-34', factor: 0.30 },
            { name: '35-49', factor: 0.25 },
            { name: '50-74', factor: 0.45 }
          ]
        },
        {
          group: 'Linear TV Service',
          subgroups: [
            { name: 'Yes', factor: 0.60 },
            { name: 'No', factor: 0.40 }
          ]
        },
        {
          group: 'Ad Plan Preference',
          subgroups: [
            { name: 'Full Ads', factor: 0.40 },
            { name: '50% Fewer Ads', factor: 0.35 },
            { name: 'No Ads', factor: 0.25 }
          ]
        }
      ];
      
      // Calculate values for each segment and product
      const totalTAM = 250000000; // Example TAM
      const baseConversionRate = 0.02; // 2% base conversion
      
      const data = segments.map(segment => ({
        group: segment.group,
        rows: segment.subgroups.map(subgroup => {
          const row = { 
            name: subgroup.name, 
            values: {},
            indent: subgroup.indent || null 
          };
          
          activeConfiguredProducts.forEach(product => {
            // Calculate based on product configuration
            let value = subgroup.factor;
            
            // Adjust based on product type
            if (product.config.product === 'CNN All-Access') value *= 0.8;
            else if (product.config.product === 'CNN Streaming') value *= 1.1;
            else if (product.config.product === 'CNN Reader') value *= 1.2;
            
            // Adjust based on features
            value *= (1 + (product.config.readerFeatures.length * 0.02));
            value *= (1 + (product.config.streamingFeatures.length * 0.015));
            value *= (1 + (product.config.verticals.length * 0.05));
            
            // Calculate final output
            if (outputType === 'percentage') {
              row.values[product.id] = (value * baseConversionRate * 100).toFixed(2) + '%';
            } else if (outputType === 'population') {
              row.values[product.id] = Math.round(totalTAM * subgroup.factor * value * baseConversionRate).toLocaleString();
            } else { // revenue
              const monthlyRevenue = totalTAM * subgroup.factor * value * baseConversionRate * product.config.monthlyRate;
              row.values[product.id] = '$' + Math.round(monthlyRevenue).toLocaleString();
            }
          });
          
          return row;
        })
      }));
      
      return { products: activeConfiguredProducts, data };
    }

    // Display the report in table format
    function displayReport(reportData, reportType, outputType) {
      const { products, data } = reportData;
      
      // Update title
      const outputLabels = {
        percentage: 'Take Rates',
        population: 'Population Counts',
        revenue: 'Monthly Revenue'
      };
      document.getElementById('reportTitle').textContent = 
        `Simulation Report - ${outputLabels[outputType]} (${reportType === 'tiered' ? 'Tiered Bundles' : 'Independent Products'})`;
      
      // Build table
      let html = '<table class="report-table"><thead><tr><th>Segment</th>';
      
      // Add product columns
      products.forEach(p => {
        html += `<th>${p.name}<br><small>${p.config.product}</small></th>`;
      });
      html += '</tr></thead><tbody>';
      
      // Add data rows
      data.forEach(segment => {
        // Group header
        html += `<tr class="group-header"><td colspan="${products.length + 1}">${segment.group}</td></tr>`;
        
        // Subgroup rows
        segment.rows.forEach(row => {
          const indentClass = row.indent === 1 ? 'sub-row-indent' : (row.indent === 0 && segment.group === 'News Access & Subscriptions' ? 'sub-row-parent' : 'sub-row');
          html += `<tr><td class="${indentClass}">${row.name}</td>`;
          products.forEach(p => {
            html += `<td>${row.values[p.id]}</td>`;
          });
          html += '</tr>';
        });
      });
      
      html += '</tbody></table>';
      
      document.getElementById('reportContent').innerHTML = html;
    }

    // Download report as CSV
    function downloadReport() {
      const table = document.querySelector('.report-table');
      let csv = [];
      
      // Get headers
      const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.replace(/\n/g, ' '));
      csv.push(headers.join(','));
      
      // Get data rows
      const rows = table.querySelectorAll('tbody tr');
      rows.forEach(row => {
        const cells = Array.from(row.querySelectorAll('td')).map(td => td.textContent);
        csv.push(cells.join(','));
      });
      
      // Download
      const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'cnn_simulation_report_' + new Date().toISOString().split('T')[0] + '.csv';
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</head>
<body>
  <div class="main-header">
    <h1 class="welcome-title">Welcome to the CNN News Subscription Simulator</h1>
    <p class="welcome-subtitle">Configure up to 8 subscription products and run detailed market simulations</p>
    
    <div class="header-buttons">
      <button class="header-button set-report-button" onclick="setReportType()">
        <span style="margin-right: 5px;">📊</span> Set Report Type
      </button>
      <button class="header-button run-simulation-button" onclick="runSimulation()">
        <span style="margin-right: 5px;">▶️</span> Run Simulation
      </button>
    </div>
    
    <div class="report-type-display" id="reportTypeDisplay"></div>
  </div>

  <div class="modal-overlay" id="featureModal">
    <div class="modal">
      <h3 id="modalTitle">Select Feature</h3>
      <div class="modal-options" id="modalOptions"></div>
      <div class="modal-buttons">
        <button class="modal-add" onclick="addSelectedFeatures()">Add Selected</button>
        <button class="modal-cancel" onclick="closeModal()">Cancel</button>
      </div>
    </div>
  </div>
  
  <div class="report-modal" id="reportModal">
    <div class="report-modal-content">
      <h2>Configure Report</h2>
      
      <div class="report-option">
        <label>Report Type:</label>
        <div>
          <label><input type="radio" name="reportType" value="tiered" checked> Products Included as Part of Tiered Bundles</label>
          <label><input type="radio" name="reportType" value="independent"> Each Product as Independent Product</label>
        </div>
      </div>
      
      <div class="report-option">
        <label>Select Output:</label>
        <div>
          <label><input type="radio" name="outputType" value="percentage" checked> Take Rates (%)</label>
          <label><input type="radio" name="outputType" value="population"> Population Counts (#)</label>
          <label><input type="radio" name="outputType" value="revenue"> Revenue ($)</label>
        </div>
      </div>
      
      <div class="report-buttons">
        <button class="generate-report" onclick="generateReport()">Set Report Type</button>
        <button class="cancel-report" onclick="closeReportModal()">Cancel</button>
      </div>
    </div>
  </div>
  
  <div class="controls-section">
    <h2>Select Products to Include in Simulation</h2>
    <button class="clear-button" onclick="clearAllSelections()">
      <span style="margin-right: 5px;">🗑️</span> Clear All Selections
    </button>
    <div class="product-toggles" id="productToggles">
      <button class="toggle-btn active" onclick="toggleProduct(1)">Product 1</button>
      <button class="toggle-btn active" onclick="toggleProduct(2)">Product 2</button>
      <button class="toggle-btn active" onclick="toggleProduct(3)">Product 3</button>
      <button class="toggle-btn active" onclick="toggleProduct(4)">Product 4</button>
      <button class="toggle-btn" onclick="toggleProduct(5)">Product 5</button>
      <button class="toggle-btn" onclick="toggleProduct(6)">Product 6</button>
      <button class="toggle-btn" onclick="toggleProduct(7)">Product 7</button>
      <button class="toggle-btn" onclick="toggleProduct(8)">Product 8</button>
    </div>
    <div class="select-controls">
      <button onclick="selectAllProducts()">Select All</button>
      <button onclick="deselectAllProducts()">Deselect All</button>
      <button onclick="selectProducts([1,2,3,4])">Select 1-4</button>
      <button onclick="selectProducts([5,6,7,8])">Select 5-8</button>
    </div>
  </div>
  
  <div class="card-container">
    <div class="card active" data-card="1">
      <div class="header">PRODUCT 1</div>
      <select class="product-select" onchange="updateCard(this.parentElement, this.value)">
        <option value="">Select Base Product</option>
        <option value="CNN Reader">CNN Reader</option>
        <option value="CNN Streaming">CNN Streaming</option>
        <option value="CNN All-Access">CNN All-Access</option>
        <option value="CNN Standalone Vertical">CNN Standalone Vertical</option>
      </select>
      <div class="content"></div>
    </div>
    
    <div class="card active" data-card="2">
      <div class="header">PRODUCT 2</div>
      <select class="product-select" onchange="updateCard(this.parentElement, this.value)">
        <option value="">Select Base Product</option>
        <option value="CNN Reader">CNN Reader</option>
        <option value="CNN Streaming">CNN Streaming</option>
        <option value="CNN All-Access">CNN All-Access</option>
        <option value="CNN Standalone Vertical">CNN Standalone Vertical</option>
      </select>
      <div class="content"></div>
    </div>
    
    <div class="card active" data-card="3">
      <div class="header">PRODUCT 3</div>
      <select class="product-select" onchange="updateCard(this.parentElement, this.value)">
        <option value="">Select Base Product</option>
        <option value="CNN Reader">CNN Reader</option>
        <option value="CNN Streaming">CNN Streaming</option>
        <option value="CNN All-Access">CNN All-Access</option>
        <option value="CNN Standalone Vertical">CNN Standalone Vertical</option>
      </select>
      <div class="content"></div>
    </div>
    
    <div class="card active" data-card="4">
      <div class="header">PRODUCT 4</div>
      <select class="product-select" onchange="updateCard(this.parentElement, this.value)">
        <option value="">Select Base Product</option>
        <option value="CNN Reader">CNN Reader</option>
        <option value="CNN Streaming">CNN Streaming</option>
        <option value="CNN All-Access">CNN All-Access</option>
        <option value="CNN Standalone Vertical">CNN Standalone Vertical</option>
      </select>
      <div class="content"></div>
    </div>
    
    <div class="card inactive" data-card="5">
      <div class="header">PRODUCT 5</div>
      <select class="product-select" onchange="updateCard(this.parentElement, this.value)">
        <option value="">Select Base Product</option>
        <option value="CNN Reader">CNN Reader</option>
        <option value="CNN Streaming">CNN Streaming</option>
        <option value="CNN All-Access">CNN All-Access</option>
        <option value="CNN Standalone Vertical">CNN Standalone Vertical</option>
      </select>
      <div class="content"></div>
    </div>
    
    <div class="card inactive" data-card="6">
      <div class="header">PRODUCT 6</div>
      <select class="product-select" onchange="updateCard(this.parentElement, this.value)">
        <option value="">Select Base Product</option>
        <option value="CNN Reader">CNN Reader</option>
        <option value="CNN Streaming">CNN Streaming</option>
        <option value="CNN All-Access">CNN All-Access</option>
        <option value="CNN Standalone Vertical">CNN Standalone Vertical</option>
      </select>
      <div class="content"></div>
    </div>
    
    <div class="card inactive" data-card="7">
      <div class="header">PRODUCT 7</div>
      <select class="product-select" onchange="updateCard(this.parentElement, this.value)">
        <option value="">Select Base Product</option>
        <option value="CNN Reader">CNN Reader</option>
        <option value="CNN Streaming">CNN Streaming</option>
        <option value="CNN All-Access">CNN All-Access</option>
        <option value="CNN Standalone Vertical">CNN Standalone Vertical</option>
      </select>
      <div class="content"></div>
    </div>
    
    <div class="card inactive" data-card="8">
      <div class="header">PRODUCT 8</div>
      <select class="product-select" onchange="updateCard(this.parentElement, this.value)">
        <option value="">Select Base Product</option>
        <option value="CNN Reader">CNN Reader</option>
        <option value="CNN Streaming">CNN Streaming</option>
        <option value="CNN All-Access">CNN All-Access</option>
        <option value="CNN Standalone Vertical">CNN Standalone Vertical</option>
      </select>
      <div class="content"></div>
    </div>
  </div>

  <div class="report-container" id="reportContainer">
    <div class="report-header">
      <h2 id="reportTitle">Simulation Report</h2>
      <button class="download-btn" onclick="downloadReport()">Download CSV</button>
    </div>
    <div id="reportContent"></div>
  </div>
</body>
</html>
